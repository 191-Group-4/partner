<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Devise::FailureApp - RDoc Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">ActionController::Metal
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">ActionController::RackDelegation</span>
  
  
  
    <li><span class="include">ActionController::UrlFor</span>
  
  
  
    <li><span class="include">ActionController::Redirecting</span>
  
  
  
    <li><span class="include">Rails</span>
  
  
  
    <li><a class="include" href="Controllers/StoreLocation.html">Devise::Controllers::StoreLocation</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-call">::call</a>
    
    <li ><a href="#method-c-default_url_options">::default_url_options</a>
    
    <li ><a href="#method-i-attempted_path">#attempted_path</a>
    
    <li ><a href="#method-i-http_auth">#http_auth</a>
    
    <li ><a href="#method-i-http_auth-3F">#http_auth?</a>
    
    <li ><a href="#method-i-http_auth_body">#http_auth_body</a>
    
    <li ><a href="#method-i-http_auth_header-3F">#http_auth_header?</a>
    
    <li ><a href="#method-i-i18n_message">#i18n_message</a>
    
    <li ><a href="#method-i-i18n_options">#i18n_options</a>
    
    <li ><a href="#method-i-is_navigational_format-3F">#is_navigational_format?</a>
    
    <li ><a href="#method-i-recall">#recall</a>
    
    <li ><a href="#method-i-recall_app">#recall_app</a>
    
    <li ><a href="#method-i-redirect">#redirect</a>
    
    <li ><a href="#method-i-redirect_url">#redirect_url</a>
    
    <li ><a href="#method-i-request_format">#request_format</a>
    
    <li ><a href="#method-i-respond">#respond</a>
    
    <li ><a href="#method-i-scope">#scope</a>
    
    <li ><a href="#method-i-scope_url">#scope_url</a>
    
    <li ><a href="#method-i-skip_format-3F">#skip_format?</a>
    
    <li ><a href="#method-i-store_location-21">#store_location!</a>
    
    <li ><a href="#method-i-warden">#warden</a>
    
    <li ><a href="#method-i-warden_message">#warden_message</a>
    
    <li ><a href="#method-i-warden_options">#warden_options</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Devise::FailureApp">
  <h1 id="class-Devise::FailureApp" class="class">
    class Devise::FailureApp
  </h1>

  <section class="description">
    
<p>Failure application that will be called every time :warden is thrown from
any strategy or hook. Responsible for redirect the user to the sign in page
based on current scope and mapping. If no scope is given, redirect to the
default_url.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 20</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-ivar">@respond</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">action</span>(<span class="ruby-value">:respond</span>)
  <span class="ruby-ivar">@respond</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-default_url_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_url_options</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="default_url_options-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">default_url_options</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">ApplicationController</span>)
    <span class="ruby-constant">ApplicationController</span>.<span class="ruby-identifier">default_url_options</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">else</span>
    {}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-http_auth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_auth</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="http_auth-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 43</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_auth</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-value">401</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;WWW-Authenticate&quot;</span>] = <span class="ruby-node">%Q(Basic realm=#{Devise.http_authentication_realm.inspect})</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">http_auth_header?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">content_type</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">response_body</span> = <span class="ruby-identifier">http_auth_body</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recall" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recall</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="recall-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">recall</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;PATH_INFO&quot;</span>]  = <span class="ruby-identifier">attempted_path</span>
  <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span>[<span class="ruby-value">:alert</span>] = <span class="ruby-identifier">i18n_message</span>(<span class="ruby-value">:invalid</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">response</span> = <span class="ruby-identifier">recall_app</span>(<span class="ruby-identifier">warden_options</span>[<span class="ruby-value">:recall</span>]).<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-redirect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">redirect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="redirect-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">redirect</span>
  <span class="ruby-identifier">store_location!</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">flash</span>[<span class="ruby-value">:timedout</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">flash</span>[<span class="ruby-value">:alert</span>]
    <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">keep</span>(<span class="ruby-value">:timedout</span>)
    <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">keep</span>(<span class="ruby-value">:alert</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:alert</span>] = <span class="ruby-identifier">i18n_message</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">redirect_url</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-respond" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">respond</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="respond-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">respond</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">http_auth?</span>
    <span class="ruby-identifier">http_auth</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">warden_options</span>[<span class="ruby-value">:recall</span>]
    <span class="ruby-identifier">recall</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-attempted_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attempted_path</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="attempted_path-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attempted_path</span>
  <span class="ruby-identifier">warden_options</span>[<span class="ruby-value">:attempted_path</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-http_auth-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_auth?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Choose whether we should respond in a http authentication fashion,
including 401 and optional headers.</p>

<p>This method allows the user to explicitly disable http authentication on
ajax requests in case they want to redirect on failures instead of handling
the errors on their own. This is useful in case your ajax API is the same
as your public API and uses a format like JSON (so you cannot mark JSON as
a navigational format).</p>
          
          

          
          <div class="method-source-code" id="http_auth-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_auth?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
    <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">http_authenticatable_on_xhr</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-operator">!</span>(<span class="ruby-identifier">request_format</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">is_navigational_format?</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-http_auth_body" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_auth_body</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="http_auth_body-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_auth_body</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">i18n_message</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">request_format</span>
  <span class="ruby-identifier">method</span> = <span class="ruby-node">&quot;to_#{request_format}&quot;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;to_xml&quot;</span>
    { <span class="ruby-identifier">error</span><span class="ruby-operator">:</span> <span class="ruby-identifier">i18n_message</span> }.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">root</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;errors&quot;</span>)
  <span class="ruby-keyword">elsif</span> {}.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">method</span>)
    { <span class="ruby-identifier">error</span><span class="ruby-operator">:</span> <span class="ruby-identifier">i18n_message</span> }.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">method</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">i18n_message</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-http_auth_header-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">http_auth_header?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>It does not make sense to send authenticate headers in ajax requests or if
the user disabled them.</p>
          
          

          
          <div class="method-source-code" id="http_auth_header-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 146</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">http_auth_header?</span>
  <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">mappings</span>[<span class="ruby-identifier">scope</span>].<span class="ruby-identifier">to</span>.<span class="ruby-identifier">http_authenticatable</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-i18n_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">i18n_message</span><span
            class="method-args">(default = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="i18n_message-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">i18n_message</span>(<span class="ruby-identifier">default</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">message</span> = <span class="ruby-identifier">warden_message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">default</span> <span class="ruby-operator">||</span> <span class="ruby-value">:unauthenticated</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">message</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Symbol</span>)
    <span class="ruby-identifier">options</span> = {}
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:resource_name</span>] = <span class="ruby-identifier">scope</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:scope</span>] = <span class="ruby-string">&quot;devise.failure&quot;</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:default</span>] = [<span class="ruby-identifier">message</span>]
    <span class="ruby-identifier">options</span> = <span class="ruby-identifier">i18n_options</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-constant">I18n</span>.<span class="ruby-identifier">t</span>(<span class="ruby-value">:&quot;#{scope}.#{message}&quot;</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">message</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-i18n_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">i18n_options</span><span
            class="method-args">(options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="i18n_options-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">i18n_options</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">options</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_navigational_format-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_navigational_format?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_navigational_format-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_navigational_format?</span>
  <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">navigational_formats</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">request_format</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recall_app" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recall_app</span><span
            class="method-args">(app)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="recall_app-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 162</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">recall_app</span>(<span class="ruby-identifier">app</span>)
  <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">action</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">split</span>(<span class="ruby-node">&quot;#&quot;</span>)
  <span class="ruby-identifier">controller_name</span>  = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">camelize</span>(<span class="ruby-identifier">controller</span>)
  <span class="ruby-identifier">controller_klass</span> = <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">constantize</span>(<span class="ruby-node">&quot;#{controller_name}Controller&quot;</span>)
  <span class="ruby-identifier">controller_klass</span>.<span class="ruby-identifier">action</span>(<span class="ruby-identifier">action</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-redirect_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">redirect_url</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="redirect_url-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">redirect_url</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">warden_message</span> <span class="ruby-operator">==</span> <span class="ruby-value">:timeout</span>
    <span class="ruby-identifier">flash</span>[<span class="ruby-value">:timedout</span>] = <span class="ruby-keyword">true</span>

    <span class="ruby-identifier">path</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span>
      <span class="ruby-identifier">attempted_path</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">request</span>.<span class="ruby-identifier">referrer</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">path</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">scope_url</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">scope_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-request_format" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">request_format</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="request_format-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">request_format</span>
  <span class="ruby-ivar">@request_format</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">format</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:ref</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-scope" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scope</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="scope-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">scope</span>
  <span class="ruby-ivar">@scope</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">warden_options</span>[<span class="ruby-value">:scope</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">default_scope</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-scope_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scope_url</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="scope_url-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">scope_url</span>
  <span class="ruby-identifier">opts</span>  = {}
  <span class="ruby-identifier">route</span> = <span class="ruby-value">:&quot;new_#{scope}_session_url&quot;</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:format</span>] = <span class="ruby-identifier">request_format</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">skip_format?</span>

  <span class="ruby-identifier">config</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">config</span>
  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:script_name</span>] = (<span class="ruby-identifier">config</span>.<span class="ruby-identifier">relative_url_root</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">config</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:relative_url_root</span>))

  <span class="ruby-identifier">context</span> = <span class="ruby-identifier">send</span>(<span class="ruby-constant">Devise</span>.<span class="ruby-identifier">available_router_name</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">context</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">route</span>)
    <span class="ruby-identifier">context</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">route</span>, <span class="ruby-identifier">opts</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:root_url</span>)
    <span class="ruby-identifier">root_url</span>(<span class="ruby-identifier">opts</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;/&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-skip_format-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">skip_format?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="skip_format-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 124</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">skip_format?</span>
  <span class="ruby-node">%w(html */*)</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">request_format</span>.<span class="ruby-identifier">to_s</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-store_location-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">store_location!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Stores requested uri to redirect the user after signing in. We cannot use
scoped session provided by warden here, since the user is not authenticated
yet, but we still need to store the uri based on scope, so different scopes
would never use the same uri to redirect.</p>
          
          

          
          <div class="method-source-code" id="store_location-21-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 193</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">store_location!</span>
  <span class="ruby-identifier">store_location_for</span>(<span class="ruby-identifier">scope</span>, <span class="ruby-identifier">attempted_path</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">http_auth?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-warden" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warden</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="warden-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">warden</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;warden&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-warden_message" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warden_message</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="warden_message-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">warden_message</span>
  <span class="ruby-ivar">@message</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">warden_options</span>[<span class="ruby-value">:message</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-warden_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warden_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="warden_options-source">
            <pre><span class="ruby-comment"># File lib/devise/failure_app.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">warden_options</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;warden.options&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

