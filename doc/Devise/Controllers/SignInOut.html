<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Devise::Controllers::SignInOut - RDoc Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-sign_in">#sign_in</a>
    
    <li ><a href="#method-i-sign_out">#sign_out</a>
    
    <li ><a href="#method-i-sign_out_all_scopes">#sign_out_all_scopes</a>
    
    <li ><a href="#method-i-signed_in-3F">#signed_in?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Devise::Controllers::SignInOut">
  <h1 id="module-Devise::Controllers::SignInOut" class="module">
    module Devise::Controllers::SignInOut
  </h1>

  <section class="description">
    
<p>Provide sign in and sign out functionality. Included by default in all
controllers.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-sign_in" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sign_in</span><span
            class="method-args">(resource_or_scope, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sign in a user that already was authenticated. This helper is useful for
logging users in after sign up.</p>

<p>All options given to <a href="SignInOut.html#method-i-sign_in">#sign_in</a>
is passed forward to the set_user method in warden. The only exception is
the :bypass option, which bypass warden callbacks and stores the user
straight in session. This option is useful in cases the user is already
signed in, but we want to refresh the credentials in session.</p>

<p>Examples:</p>

<pre>sign_in :user, @user                      # sign_in(scope, resource)
sign_in @user                             # sign_in(resource)
sign_in @user, event: :authentication  # sign_in(resource, options)
sign_in @user, store: false            # sign_in(resource, options)
sign_in @user, bypass: true            # sign_in(resource, options)</pre>
          
          

          
          <div class="method-source-code" id="sign_in-source">
            <pre><span class="ruby-comment"># File lib/devise/controllers/sign_in_out.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sign_in</span>(<span class="ruby-identifier">resource_or_scope</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">options</span>  = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">extract_options!</span>
  <span class="ruby-identifier">scope</span>    = <span class="ruby-constant">Devise</span><span class="ruby-operator">::</span><span class="ruby-constant">Mapping</span>.<span class="ruby-identifier">find_scope!</span>(<span class="ruby-identifier">resource_or_scope</span>)
  <span class="ruby-identifier">resource</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">resource_or_scope</span>

  <span class="ruby-identifier">expire_data_after_sign_in!</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:bypass</span>]
    <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">session_serializer</span>.<span class="ruby-identifier">store</span>(<span class="ruby-identifier">resource</span>, <span class="ruby-identifier">scope</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">user</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">resource</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:force</span>)
    <span class="ruby-comment"># Do nothing. User already signed in and we are not forcing it.</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">set_user</span>(<span class="ruby-identifier">resource</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-identifier">scope</span><span class="ruby-operator">:</span> <span class="ruby-identifier">scope</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sign_out" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sign_out</span><span
            class="method-args">(resource_or_scope=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sign out a given user or scope. This helper is useful for signing out a
user after deleting accounts. Returns true if there was a logout and false
if there is no user logged in on the referred scope</p>

<p>Examples:</p>

<pre>sign_out :user     # sign_out(scope)
sign_out @user     # sign_out(resource)</pre>
          
          

          
          <div class="method-source-code" id="sign_out-source">
            <pre><span class="ruby-comment"># File lib/devise/controllers/sign_in_out.rb, line 56</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sign_out</span>(<span class="ruby-identifier">resource_or_scope</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">sign_out_all_scopes</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resource_or_scope</span>
  <span class="ruby-identifier">scope</span> = <span class="ruby-constant">Devise</span><span class="ruby-operator">::</span><span class="ruby-constant">Mapping</span>.<span class="ruby-identifier">find_scope!</span>(<span class="ruby-identifier">resource_or_scope</span>)
  <span class="ruby-identifier">user</span> = <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">user</span>(<span class="ruby-identifier">scope</span><span class="ruby-operator">:</span> <span class="ruby-identifier">scope</span>, <span class="ruby-identifier">run_callbacks</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>) <span class="ruby-comment"># If there is no user</span>

  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">raw_session</span>.<span class="ruby-identifier">inspect</span> <span class="ruby-comment"># Without this inspect here. The session does not clear.</span>
  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">logout</span>(<span class="ruby-identifier">scope</span>)
  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">clear_strategies_cache!</span>(<span class="ruby-identifier">scope</span><span class="ruby-operator">:</span> <span class="ruby-identifier">scope</span>)
  <span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:&quot;@current_#{scope}&quot;</span>, <span class="ruby-keyword">nil</span>)

  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sign_out_all_scopes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sign_out_all_scopes</span><span
            class="method-args">(lock=true)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sign out all active users or scopes. This helper is useful for signing out
all roles in one click. This signs out ALL scopes in warden. Returns true
if there was at least one logout and false if there was no user logged in
on all scopes.</p>
          
          

          
          <div class="method-source-code" id="sign_out_all_scopes-source">
            <pre><span class="ruby-comment"># File lib/devise/controllers/sign_in_out.rb, line 72</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sign_out_all_scopes</span>(<span class="ruby-identifier">lock</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">users</span> = <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">user</span>(<span class="ruby-identifier">scope</span><span class="ruby-operator">:</span> <span class="ruby-identifier">s</span>, <span class="ruby-identifier">run_callbacks</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>) }

  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">logout</span>
  <span class="ruby-identifier">expire_data_after_sign_out!</span>
  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">clear_strategies_cache!</span>
  <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">lock!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lock</span>

  <span class="ruby-identifier">users</span>.<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-signed_in-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">signed_in?</span><span
            class="method-args">(scope=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return true if the given scope is signed in session. If no scope given,
return true if any scope is signed in. Does not run authentication hooks.</p>
          
          

          
          <div class="method-source-code" id="signed_in-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/controllers/sign_in_out.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">signed_in?</span>(<span class="ruby-identifier">scope</span>=<span class="ruby-keyword">nil</span>)
  [ <span class="ruby-identifier">scope</span> <span class="ruby-operator">||</span> <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">mappings</span>.<span class="ruby-identifier">keys</span> ].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">any?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_scope</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">warden</span>.<span class="ruby-identifier">authenticate?</span>(<span class="ruby-identifier">scope</span><span class="ruby-operator">:</span> <span class="ruby-identifier">_scope</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

