<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module Devise::Models::Recoverable - RDoc Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#module-Devise::Models::Recoverable-label-Options">Options</a>
    <li><a href="#module-Devise::Models::Recoverable-label-Examples">Examples</a>
  </ul>
</div>


  <div id="class-metadata">
    
    
    
    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">ActiveSupport::Concern</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-required_fields">::required_fields</a>
    
    <li ><a href="#method-i-after_password_reset">#after_password_reset</a>
    
    <li ><a href="#method-i-clear_reset_password_token">#clear_reset_password_token</a>
    
    <li ><a href="#method-i-reset_password-21">#reset_password!</a>
    
    <li ><a href="#method-i-reset_password_period_valid-3F">#reset_password_period_valid?</a>
    
    <li ><a href="#method-i-send_reset_password_instructions">#send_reset_password_instructions</a>
    
    <li ><a href="#method-i-send_reset_password_instructions_notification">#send_reset_password_instructions_notification</a>
    
    <li ><a href="#method-i-set_reset_password_token">#set_reset_password_token</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-Devise::Models::Recoverable">
  <h1 id="module-Devise::Models::Recoverable" class="module">
    module Devise::Models::Recoverable
  </h1>

  <section class="description">
    
<p><a href="Recoverable.html">Recoverable</a> takes care of resetting the user
password and send reset instructions.</p>

<h2 id="module-Devise::Models::Recoverable-label-Options">Options<span><a href="#module-Devise::Models::Recoverable-label-Options">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p><a href="Recoverable.html">Recoverable</a> adds the following options to
devise_for:</p>

<pre>* +reset_password_keys+: the keys you want to use when recovering the password for an account</pre>

<h2 id="module-Devise::Models::Recoverable-label-Examples">Examples<span><a href="#module-Devise::Models::Recoverable-label-Examples">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<pre># resets the user password and save the record, true if valid passwords are given, otherwise false
User.find(1).reset_password!(&#39;password123&#39;, &#39;password123&#39;)

# only resets the user password, without saving the record
user = User.find(1)
user.reset_password(&#39;password123&#39;, &#39;password123&#39;)

# creates a new token and send it with instructions about how to reset the password
User.find(1).send_reset_password_instructions</pre>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-required_fields" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">required_fields</span><span
            class="method-args">(klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="required_fields-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">required_fields</span>(<span class="ruby-identifier">klass</span>)
  [<span class="ruby-value">:reset_password_sent_at</span>, <span class="ruby-value">:reset_password_token</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-reset_password-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_password!</span><span
            class="method-args">(new_password, new_password_confirmation)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Update password saving the record and clearing token. Returns true if the
passwords are valid and the record was saved, false otherwise.</p>
          
          

          
          <div class="method-source-code" id="reset_password-21-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 33</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_password!</span>(<span class="ruby-identifier">new_password</span>, <span class="ruby-identifier">new_password_confirmation</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">new_password</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">password_confirmation</span> = <span class="ruby-identifier">new_password_confirmation</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">valid?</span>
    <span class="ruby-identifier">clear_reset_password_token</span>
    <span class="ruby-identifier">after_password_reset</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reset_password_period_valid-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset_password_period_valid?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Checks if the reset password token sent is within the limit time. We do
this by calculating if the difference between today and the sending date
does not exceed the confirm in time configured. Returns true if the
resource is not responding to reset_password_sent_at at all.
reset_password_within is a model configuration, must always be an integer
value.</p>

<p>Example:</p>

<pre># reset_password_within = 1.day and reset_password_sent_at = today
reset_password_period_valid?   # returns true

# reset_password_within = 5.days and reset_password_sent_at = 4.days.ago
reset_password_period_valid?   # returns true

# reset_password_within = 5.days and reset_password_sent_at = 5.days.ago
reset_password_period_valid?   # returns false

# reset_password_within = 0.days
reset_password_period_valid?   # will always return false</pre>
          
          

          
          <div class="method-source-code" id="reset_password_period_valid-3F-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset_password_period_valid?</span>
  <span class="ruby-identifier">reset_password_sent_at</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">reset_password_sent_at</span>.<span class="ruby-identifier">utc</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">reset_password_within</span>.<span class="ruby-identifier">ago</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-send_reset_password_instructions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_reset_password_instructions</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Resets reset password token and send reset password instructions by email.
Returns the token sent in the e-mail.</p>
          
          

          
          <div class="method-source-code" id="send_reset_password_instructions-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_reset_password_instructions</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">set_reset_password_token</span>
  <span class="ruby-identifier">send_reset_password_instructions_notification</span>(<span class="ruby-identifier">token</span>)

  <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-after_password_reset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after_password_reset</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="after_password_reset-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 86</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after_password_reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-clear_reset_password_token" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_reset_password_token</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Removes reset_password token</p>
          
          

          
          <div class="method-source-code" id="clear_reset_password_token-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_reset_password_token</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset_password_token</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset_password_sent_at</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-send_reset_password_instructions_notification" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">send_reset_password_instructions_notification</span><span
            class="method-args">(token)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="send_reset_password_instructions_notification-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">send_reset_password_instructions_notification</span>(<span class="ruby-identifier">token</span>)
  <span class="ruby-identifier">send_devise_notification</span>(<span class="ruby-value">:reset_password_instructions</span>, <span class="ruby-identifier">token</span>, {})
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_reset_password_token" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_reset_password_token</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_reset_password_token-source">
            <pre><span class="ruby-comment"># File lib/devise/models/recoverable.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_reset_password_token</span>
  <span class="ruby-identifier">raw</span>, <span class="ruby-identifier">enc</span> = <span class="ruby-constant">Devise</span>.<span class="ruby-identifier">token_generator</span>.<span class="ruby-identifier">generate</span>(<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>, <span class="ruby-value">:reset_password_token</span>)

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset_password_token</span>   = <span class="ruby-identifier">enc</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">reset_password_sent_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">utc</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">save</span>(<span class="ruby-identifier">validate</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">raw</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

