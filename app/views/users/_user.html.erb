<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
<script>
$(function() {
    var moveLeft = 0;
    var moveDown = 0;
    $('a.popper').hover(function(e) {
   
        var target = '#' + ($(this).attr('data-popbox'));
         
        $(target).show();
        moveLeft = $(this).outerWidth();
        moveDown = ($(target).outerHeight() / 2);
    }, function() {
        var target = '#' + ($(this).attr('data-popbox'));
        $(target).hide();
    });
 
    $('a.popper').mousemove(function(e) {
        var target = '#' + ($(this).attr('data-popbox'));
         
        leftD = e.pageX + parseInt(moveLeft);
        maxRight = leftD + $(target).outerWidth();
        windowLeft = $(window).width() - 40;
        windowRight = 0;
        maxLeft = e.pageX - (parseInt(moveLeft) + $(target).outerWidth() + 20);
         
        if(maxRight > windowLeft && maxLeft > windowRight)
        {
            leftD = maxLeft;
        }
     
        topD = e.pageY - parseInt(moveDown);
        maxBottom = parseInt(e.pageY + parseInt(moveDown) + 20);
        windowBottom = parseInt(parseInt($(document).scrollTop()) + parseInt($(window).height()));
        maxTop = topD;
        windowTop = parseInt($(document).scrollTop());
        if(maxBottom > windowBottom)
        {
            topD = windowBottom - $(target).outerHeight() - 20;
        } else if(maxTop < windowTop){
            topD = windowTop + 20;
        }
     
        $(target).css('top', topD).css('left', leftD);
     
     
    });
 
});
</script>


<div id="pop1" class="popbox">
    <h2>Success!</h2>
    <p>This is an example popbox.</p>
</div>
<div id="pop2" class="popbox">
    <h2>Danger!</h2>
    <p>Don't let this popbox go off the screen!</p>
</div>
<%case current_user.role %>
<%when "user"%>
  	<% if current_user.id != user.id%> 
		<% if user.role == "user" && current_user.status == false%>
				<td><%= link_to (image_tag (user.avatar.url), :style => 'max-height: 25xpx; max-width: 25px;'), user %></td> <td><%= link_to user.name, user %></td>     <td><%= user.email %></td>	
				<% if user.status == false%>
						<td>Available</td>
						<td><%=  link_to "Partner", flop_user_path(user), :class=>"requestbutton" %></td><td></td>
				<%else%><td>Partnered</td><td></td>
				<% end %>
		<%elsif current_user.partner1 == user.name %>
					<td><%= link_to user.name, user %></td>
					<td><%= user.email %></td>	
					<td>You are already partnered with <%= current_user.partner1 %> </td>
					<td><%=  link_to "UNDO", flop_user_path(user), :class=>"button" %></td>
		<% end %>
	<%end%>
<%when "vip"%>
  <% if user.role=="user"%>
         <tr> <td><%= user.name %></td><td><%= user.partner1 %></td></tr>
	<%end%>
<%when "admin"%>
  <% if user.role=="user" && user.confirmed_at==nil%> 
         <tr> <td><a href="" class="popper" data-popbox="pop1"><%= user.name %></a></td><td><%=  link_to "Confirm", confirm_user_path(user), :class=>"button" %></td><td></td>
	<%end%>
<%end%>


 
